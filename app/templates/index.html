{% extends "base.html" %} {% block title %}My Todos - Flask Todo App{% endblock %} {% block content %}
<div class="row">
  <div class="col-12">
    <!-- Welcome Header -->
    <div class="card mb-4">
      <div class="card-header">
        <h3 class="mb-0"><i class="fas fa-user"></i> Welcome back, {{ current_user.username }}!</h3>
      </div>
      <div class="card-body">
        <p class="mb-0 text-muted">
          <i class="fas fa-info-circle"></i>
          You have {{ todos|length }} todo{{ 's' if todos|length != 1 else '' }} {% if todos %} ({{ todos|selectattr('completed')|list|length }}
          completed, {{ todos|rejectattr('completed')|list|length }} pending) {% endif %}
        </p>
      </div>
    </div>

    <!-- Add New Todo Form -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-plus"></i> Add New Todo</h5>
      </div>
      <div class="card-body">
        <form method="POST" action="{{ url_for('main.add_todo') }}" class="d-flex gap-2">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
          <input
            type="text"
            name="description"
            class="form-control"
            placeholder="What do you need to do?"
            required
            maxlength="200"
            autocomplete="off"
          />
          <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Add Todo</button>
        </form>
        <small class="form-text text-muted mt-2"> <i class="fas fa-lightbulb"></i> Tip: Keep your todos clear and actionable </small>
      </div>
    </div>

    <!-- Todo List -->
    {% if todos %}
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-list"></i> Your Todos</h5>
      </div>
      <div class="card-body p-0">
        {% for todo in todos %}
        <div class="todo-item {{ 'todo-completed' if todo.completed else '' }}">
          <div class="d-flex justify-content-between align-items-start">
            <div class="todo-content flex-grow-1">
              <div class="todo-description">
                {% if todo.completed %}
                <i class="fas fa-check-circle text-success me-2"></i>
                <span class="text-decoration-line-through">{{ todo.description }}</span>
                {% else %}
                <i class="far fa-circle text-muted me-2"></i>
                <span>{{ todo.description }}</span>
                {% endif %}
              </div>
              <small class="text-muted">
                <i class="fas fa-clock"></i>
                Created {{ todo.created_at.strftime('%B %d, %Y at %I:%M %p') }} {% if todo.completed %} â€¢ <i class="fas fa-check"></i> Completed {%
                endif %}
              </small>
            </div>

            <div class="todo-actions">
              <!-- Toggle Completion Button -->
              <form method="POST" action="{{ url_for('main.toggle_todo', todo_id=todo.id) }}" class="d-inline">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                {% if todo.completed %}
                <button type="submit" class="btn btn-outline-warning btn-sm" title="Mark as incomplete"><i class="fas fa-undo"></i> Undo</button>
                {% else %}
                <button type="submit" class="btn btn-outline-success btn-sm" title="Mark as complete"><i class="fas fa-check"></i> Complete</button>
                {% endif %}
              </form>

              <!-- Delete Button -->
              <form method="POST" action="{{ url_for('main.delete_todo', todo_id=todo.id) }}" class="d-inline">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                <button
                  type="submit"
                  class="btn btn-outline-danger btn-sm"
                  title="Delete todo"
                  onclick="return confirm('Are you sure you want to delete this todo?')"
                >
                  <i class="fas fa-trash"></i> Delete
                </button>
              </form>
            </div>
          </div>
        </div>

        {% if not loop.last %}
        <hr class="my-0" />
        {% endif %} {% endfor %}
      </div>
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="empty-state">
      <i class="fas fa-clipboard-list"></i>
      <h4>No todos yet!</h4>
      <p class="text-muted">
        Start by adding your first todo above. <br />
        Keep track of what you need to accomplish today.
      </p>
      <div class="mt-3">
        <small class="text-muted">
          <i class="fas fa-lightbulb"></i>
          Pro tip: Break down large tasks into smaller, manageable todos
        </small>
      </div>
    </div>
    {% endif %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Add loading states to action buttons
    const actionForms = document.querySelectorAll('.todo-actions form');
    actionForms.forEach((form) => {
      form.addEventListener('submit', function () {
        const button = form.querySelector('button');
        button.classList.add('btn-loading');
        button.disabled = true;
      });
    });

    // Add loading state to add todo form
    const addForm = document.querySelector('form[action*="add_todo"]');
    if (addForm) {
      addForm.addEventListener('submit', function () {
        const button = addForm.querySelector('button');
        const input = addForm.querySelector('input[name="description"]');

        if (input.value.trim()) {
          button.classList.add('btn-loading');
          button.disabled = true;
          input.disabled = true;
        }
      });
    }

    // Auto-focus on add todo input
    const todoInput = document.querySelector('input[name="description"]');
    if (todoInput) {
      todoInput.focus();
    }

    // Character counter for todo input
    const todoInputField = document.querySelector('input[name="description"]');
    if (todoInputField) {
      const maxLength = todoInputField.getAttribute('maxlength');
      const counterElement = document.createElement('small');
      counterElement.className = 'form-text text-muted position-absolute end-0 me-2';
      counterElement.style.top = '50%';
      counterElement.style.transform = 'translateY(-50%)';

      const updateCounter = () => {
        const remaining = maxLength - todoInputField.value.length;
        counterElement.textContent = `${remaining} characters remaining`;
        counterElement.style.color = remaining < 20 ? '#dc3545' : '#6c757d';
      };

      todoInputField.addEventListener('input', updateCounter);
      todoInputField.parentElement.style.position = 'relative';
      todoInputField.parentElement.appendChild(counterElement);
      updateCounter();
    }
  });
</script>
{% endblock %}
